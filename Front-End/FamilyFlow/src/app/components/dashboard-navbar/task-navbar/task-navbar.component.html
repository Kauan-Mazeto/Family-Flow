<div class="choice">
    <h3 
        [class.active]="isTabActive.diarias"
        (click)="onTabClick('diarias')"
    >
        Tarefas Diárias
    </h3>
    <h3 
        [class.active]="isTabActive.pontuais"
        (click)="onTabClick('pontuais')"
    >
        Tarefas Pontuais
    </h3>
    <h3
        [class.active]="isTabActive.grafico"
        (click)="onTabClick('grafico')"
    >
        Gráfico de Tarefas
    </h3>
</div>

<!--Conteúdo de Tarefas Diárias - Kanban Board-->
<div class="task" *ngIf="isTabActive.diarias">
    <div class="task-desc">
        <div class="desc">
            <div class="desc-text">
                <h1>Tarefas Diárias - Quadro Kanban</h1>
                <p>Tarefas criadas pelo Administrador - visíveis para toda a família</p>
            </div>

            <button class="create-task" (click)="openCreateTaskModal()" *ngIf="isAdmin">
                <i class="fas fa-plus"></i> 
                Criar Tarefa Diária
            </button>
            <div class="admin-only-message" *ngIf="!isAdmin">
                <i class="fas fa-lock"></i>
                <span>Apenas administradores podem criar tarefas diárias</span>
            </div>
        </div>
    </div>

    <!-- Quadro Kanban com dois colunas -->
    <div class="kanban-board">
        <!-- Coluna de Tarefas Atribuídas -->
        <div class="kanban-column">
            <div class="column-header">
                <h3>
                    <i class="fas fa-clipboard-list"></i>
                    Tarefas Atribuídas
                </h3>
                <span class="task-count">{{ getAssignedTasks().length }}</span>
            </div>

            <div class="column-content">
                <div class="task-card assigned" *ngFor="let task of getAssignedTasks()">
                    <div class="task-info">
                        <div class="responsible">
                            <input 
                                type="checkbox" 
                                class="check-response"
                                [checked]="false"
                                [disabled]="!canEditTask(task) || task._loading"
                                (change)="onTaskComplete(task)"
                                [title]="!canEditTask(task) ? 'Apenas o responsável pode marcar esta tarefa como concluída' : ''"
                            >
                            <span class="fas fa-trash" (click)="onDeleteTask(task)" *ngIf="isAdmin"></span>
                        </div>
                        <h2>{{ task.title }}</h2>
                        <p>{{ task.description || 'Sem descrição' }}</p>
                        <small class="task-member">Responsável: {{ task.member_name }}</small>
                    </div>

                    <div class="task-atribute">
                        <span class="task-priority" [ngClass]="'priority-' + task.priority.toLowerCase()">
                            <i class="fas fa-flag"></i>
                            {{ getPriorityLabel(task.priority) }}
                        </span>
                        <span class="task-status status-pendente">
                            <i class="fas fa-clock"></i>
                            Pendente
                        </span>
                    </div>
                </div>

                <!-- Mensagem quando não há tarefas atribuídas -->
                <div class="no-tasks" *ngIf="getAssignedTasks().length === 0">
                    <i class="fas fa-clipboard-list"></i>
                    <h4>Nenhuma tarefa atribuída</h4>
                    <p>As novas tarefas aparecerão aqui</p>
                </div>
            </div>
        </div>

        <!-- Coluna de Tarefas Concluídas -->
        <div class="kanban-column">
            <div class="column-header completed">
                <h3>
                    <i class="fas fa-check-circle"></i>
                    Tarefas Concluídas
                </h3>
                <span class="task-count completed">{{ getCompletedTasks().length }}</span>
            </div>

            <div class="column-content">
                <div class="task-card completed" *ngFor="let task of getCompletedTasks()">
                    <div class="task-info">
                        <div class="responsible">
                            <input 
                                type="checkbox" 
                                class="check-response"
                                [checked]="true"
                                [disabled]="!canEditTask(task) || task._loading"
                                (change)="onTaskUncomplete(task)"
                                [title]="!canEditTask(task) ? 'Apenas o responsável pode desmarcar esta tarefa' : ''"
                            >
                            <span class="fas fa-trash" (click)="onDeleteTask(task)" *ngIf="isAdmin"></span>
                        </div>
                        <h2>{{ task.title }}</h2>
                        <p>{{ task.description || 'Sem descrição' }}</p>
                        <small class="task-member">Responsável: {{ task.member_name }}</small>
                        <small class="completion-time" *ngIf="task.completed_at">
                            <i class="fas fa-calendar-check"></i>
                            Concluída em: {{ formatDate(task.completed_at) }}
                        </small>
                    </div>

                    <div class="task-atribute">
                        <span class="task-priority completed" [ngClass]="'priority-' + task.priority.toLowerCase()">
                            <i class="fas fa-flag"></i>
                            {{ getPriorityLabel(task.priority) }}
                        </span>
                        <span class="task-status status-concluida">
                            <i class="fas fa-check-circle"></i>
                            Concluída
                        </span>
                    </div>
                </div>

                <!-- Mensagem quando não há tarefas concluídas -->
                <div class="no-tasks" *ngIf="getCompletedTasks().length === 0">
                    <i class="fas fa-check-circle"></i>
                    <h4>Nenhuma tarefa concluída</h4>
                    <p>As tarefas concluídas aparecerão aqui</p>
                </div>
            </div>
        </div>
    </div>
</div>



<!--Conteúdo de Tarefas Pontuais-->
<div class="task" *ngIf="isTabActive.pontuais">
    <div class="task-desc">
        <div class="desc">
            <div class="desc-text">
                <h1>Tarefas Pontuais</h1>
                <p>Suas tarefas pessoais - visíveis apenas para você</p>
            </div>

            <button class="create-task">
                <i class="fas fa-plus"></i> 
                Criar Tarefa Pontual
            </button>
        </div>
    </div>

    <div class="tasks">
        <div class="task-card">
            <div class="task-info">
                <div class="responsible">
                    <input type="checkbox" class="check-response">
                    <span class="fas fa-trash"></span>
                </div>
                <h2>Tarefa Pontual Exemplo</h2>
                <p>Esta funcionalidade será implementada em breve</p>
                <small class="task-member">Responsável: Em desenvolvimento</small>
            </div>

            <div class="task-atribute">
                <span class="task-priority">Prioridade média</span>
                <span class="task-status">Em desenvolvimento</span>
            </div>
        </div>
    </div>
</div>

<!-- Modal para criar tarefa diária -->
<div class="modal-overlay" *ngIf="showCreateTaskModal" (click)="closeCreateTaskModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h2>
                <i class="fas fa-plus-circle"></i>
                Criar Nova Tarefa Diária
            </h2>
            <button class="close-btn" (click)="closeCreateTaskModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <form [formGroup]="taskForm" (ngSubmit)="onSubmitTask()" class="task-form">
            <div class="form-row">
                <div class="form-group">
                    <label for="name">Nome da Tarefa</label>
                    <input 
                        type="text" 
                        id="name" 
                        formControlName="name"
                        placeholder="Ex: Lavar a louça"
                        [class.error]="taskForm.get('name')?.invalid && taskForm.get('name')?.touched"
                    >
                    <div class="error-message" *ngIf="taskForm.get('name')?.invalid && taskForm.get('name')?.touched">
                        <span *ngIf="taskForm.get('name')?.errors?.['required']">Nome é obrigatório</span>
                        <span *ngIf="taskForm.get('name')?.errors?.['minlength']">Nome deve ter pelo menos 3 caracteres</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="member">Pessoa Responsável</label>
                    <select 
                        id="member" 
                        formControlName="member"
                    >
                        <option value="">Selecione um membro</option>
                        <option *ngFor="let member of familyMembers" [value]="member.id">
                            {{ member.name }} ({{ member.role === 'ADMIN' ? 'Admin' : 'Membro' }})
                        </option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Descrição</label>
                <textarea 
                    id="description" 
                    formControlName="description"
                    placeholder="Descreva detalhadamente a tarefa..."
                    rows="3"
                ></textarea>
            </div>

            <div class="form-group">
                <label for="priority">Nível de Prioridade</label>
                <select id="priority" formControlName="priority">
                    <option value="BAIXA">Baixa</option>
                    <option value="MEDIA">Média</option>
                    <option value="ALTA">Alta</option>
                </select>
            </div>

            <div class="form-info-note">
                <div class="info-card">
                    <i class="fas fa-info-circle"></i>
                    <div class="info-text">
                        <strong>Status Automático</strong>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn-cancel" (click)="closeCreateTaskModal()">
                    Cancelar
                </button>
                <button type="submit" class="btn-submit" [disabled]="isLoading">
                    <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
                    <i class="fas fa-check" *ngIf="!isLoading"></i>
                    {{ isLoading ? 'Criando...' : 'Criar Tarefa' }}
                </button>
            </div>
        </form>
    </div>
</div>